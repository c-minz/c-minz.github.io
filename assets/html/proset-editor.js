function generatePosetFromInput(){let e=document.getElementById("txtInput").value;poset=new Poset(e),updateSelectionBound(),setSelection(0)}function updateSelectionBound(){document.getElementById("txtSelection").max=poset.card().toString()}function getSelection(){let e=document.getElementById("txtSelection").value,t=parseInt(e,10);return t>=1&&t<=poset.card()?t:0}function setSelection(e){e<0||e>poset.card()||(document.getElementById("txtSelection").value=e.toString(),redrawPoset())}function initCanvas(e,t){e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,e.canvas.width,e.canvas.height),e.beginPath();let o=e.canvas.height/t/Math.sqrt(2);e.scale(o,-o),e.translate(t/Math.sqrt(2),-Math.sqrt(2)*t),e.rotate(45*Math.PI/180)}function drawGrid(e,t){e.strokeStyle="#f0f0f0",e.lineWidth=.05;for(let o=0;o<=t;o++)e.beginPath(),e.moveTo(0,o),e.lineTo(t,o),e.stroke(),e.beginPath(),e.moveTo(o,0),e.lineTo(o,t),e.stroke()}function redrawPoset(){let e=document.getElementById("cnvPoset"),t=e.getContext("2d"),o=getSelection();if(initCanvas(t,poset.card()),document.getElementById("chbShowCross").checked&&o>=1){t.strokeStyle="#fff0f0",t.lineWidth=1,t.beginPath(),t.moveTo(o-.5,0),t.lineTo(o-.5,poset.card());for(let e=0;e<poset.card();e++)poset.permutation[e]==o&&(t.moveTo(0,e+.5),t.lineTo(poset.card(),e+.5));t.stroke()}let n=document.getElementById("chbShowGrid").checked;n&&drawGrid(t,poset.card()),t.strokeStyle="black",t.lineWidth=.08;for(let e=0;e<poset.card();e++){let o=poset.card()+1;for(let n=e+1;n<poset.card();n++)poset.permutation[e]<poset.permutation[n]&&poset.permutation[n]<o&&(t.beginPath(),t.moveTo(poset.permutation[e]-.5,e+.5),t.lineTo(poset.permutation[n]-.5,n+.5),t.stroke(),o=poset.permutation[n])}for(let e=0;e<poset.card();e++)t.fillStyle="black",poset.permutation[e]===o&&(t.fillStyle="red"),t.beginPath(),t.ellipse(poset.permutation[e]-.5,e+.5,.25,.25,0,0,2*Math.PI),t.fill();let i=document.getElementById("chbShowLabels").checked;if(i){let n=e.width/poset.card()/2;t.setTransform(1,0,0,1,0,0),t.translate(e.width/2,e.height),t.font=(150/poset.card()).toString()+"px Arial",t.textAlign="right";for(let e=0;e<poset.card();e++){let i=poset.permutation[e],r=(i-e-1.5)*n,a=(i+e-.7)*n;t.fillStyle="black",i===o&&(t.fillStyle="red"),t.beginPath(),t.fillText(i,r,-a)}}document.getElementById("txtOutputPermutation").value=poset.toString(),document.getElementById("txtOutputLatex").value=poset.toLatexCode(i,n)}function handleKeyDown(e){switch(e.code){case"KeyA":"A"===e.key?moveU(-1):selectU(-1);break;case"KeyD":"D"===e.key?moveU(1):selectU(1);break;case"KeyS":"S"===e.key?moveV(-1):selectV(-1);break;case"KeyW":"W"===e.key?moveV(1):selectV(1);break;case"Delete":removeSelectedEvent();break;case"Period":addEvent()}}function selectU(e){setSelection(getSelection()+e)}function selectV(e){let t=getSelection(),o=poset.permutation.indexOf(t);o<0&&e<0||o===poset.card()-1&&e>0||setSelection(0===o&&e<0?0:poset.permutation[o+e])}function moveU(e){let t=getSelection();if(-1===e&&t<2)return;if(1===e&&(t<1||t===poset.card()))return;let o=t+e,n=poset.permutation.indexOf(t),i=poset.permutation.indexOf(o);poset.permutation[n]=o,poset.permutation[i]=t,setSelection(o)}function moveV(e){let t=getSelection();if(t<1)return;let o=poset.permutation.indexOf(t),n=o+e;-1===e&&(n<0||o>=poset.card())||1===e&&(o<0||n>=poset.card())||(poset.permutation[o]=poset.permutation[n],poset.permutation[n]=t,redrawPoset())}function addEvent(){poset.permutation.unshift(poset.card()+1),updateSelectionBound(),setSelection(poset.card())}function removeSelectedEvent(){let e=getSelection();if(e<1||1===poset.card())return;let t=poset.permutation.indexOf(e);poset.permutation.splice(t,1);for(let t=0;t<poset.card();t++)poset.permutation[t]>e&&(poset.permutation[t]=poset.permutation[t]-1);updateSelectionBound(),e>poset.card()&&(e=poset.card()),setSelection(e)}function turnOpposite(){const e=poset.permutation.slice();let t=getSelection(),o=0,n=poset.card();for(let i=n;i>0;i--){let r=poset.permutation[n-i];e[n-r]=i,r===t&&(o=i)}poset.permutation=e,setSelection(o)}function reflect(){const e=poset.permutation.slice();let t=getSelection(),o=0;for(let n=1;n<=poset.card();n++){let i=poset.permutation[n-1];e[i-1]=n,i===t&&(o=n)}poset.permutation=e,setSelection(o)}function copyToInput(e){let t=document.getElementById(e).value;document.getElementById("txtInput").value=t,document.getElementById("txtInput").focus()}function copyToClipboard(e){let t=document.getElementById(e).value;navigator.clipboard.writeText(t)}class Poset{constructor(e){e.constructor===Array?this.permutation=e:this.permutation=e.split(",").map(function(e){return parseInt(e,10)})}card(){return this.permutation.length}toString(){return poset.permutation.join(",")}toLatexCode(e,t){let o="\\pcauset";return e&&t?o+="X":e?o+="L":t&&(o+="P"),o+="{"+this.toString()+"}"}}let poset;window.addEventListener("keydown",handleKeyDown);